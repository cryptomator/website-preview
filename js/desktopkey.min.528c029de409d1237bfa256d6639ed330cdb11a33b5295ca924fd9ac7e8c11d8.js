"use strict";const GENERATE_PAY_LINK_URL=STORE_API_URL+"/desktop/generate-pay-link";class DesktopLicense{constructor(e,t){this._form=e,this._checkoutData=t,this._paddle=$.ajax({url:"https://cdn.paddle.com/paddle/paddle.js",cache:!0,dataType:"script"}).then(()=>(PADDLE_ENABLE_SANDBOX&&window.Paddle.Environment.set("sandbox"),window.Paddle.Setup({vendor:PADDLE_VENDOR_ID}),window.Paddle))}checkout(e){if(!$(this._form)[0].checkValidity()){$(this._form).find(":input").addClass("show-invalid"),this._checkoutData.errorMessage="Please fill in all required fields.";return}this._checkoutData.inProgress=!0,this._checkoutData.errorMessage="",this._checkoutData.success=!1,$.ajax({url:GENERATE_PAY_LINK_URL,type:"POST",data:{amount:this._checkoutData.amount,quantity:this._checkoutData.quantity}}).done(t=>{this.openPaddleCheckout(t.pay_link,e)}).fail(e=>{this.onCheckoutFailed(e.responseJSON?.message||"Generating pay link failed.")})}openPaddleCheckout(e,t){this._paddle.then(n=>{n.Checkout.open({override:e,email:this._checkoutData.email,locale:t,successCallback:e=>{this.onCheckoutSucceeded(),this.getPaddleOrderDetails(e.checkout.id)},closeCallback:()=>{this._checkoutData.inProgress=!1}})})}getPaddleOrderDetails(e){this._paddle.then(t=>{t.Order.details(e,e=>{let t=e.lockers?.[0]?.license_code;t?this._checkoutData.licenseKey=t:this._checkoutData.errorMessage="Retrieving supporter certificate failed. Please check your emails instead."})})}onCheckoutFailed(e){this._checkoutData.success=!1,this._checkoutData.errorMessage=e,this._checkoutData.inProgress=!1}onCheckoutSucceeded(){this._checkoutData.success=!0,this._checkoutData.errorMessage="",this._checkoutData.inProgress=!1}}