"use strict";const STRIPE_PK="pk_live_eSasX216vGvC26GdbVwA011V",STRIPE_PLANS={EUR:"plan_GgW4ovr7c6upzx",USD:"plan_GejOEdJtfL3kdH"},STRIPE_PHP_URL="https://api.cryptomator.org/stripe/prepare_payment.php";class OneTimePayment{constructor(e){this._status=e}initStripeField(e,t,n){let s=document.createElement("div");$(s).hide(),$(e).after(s),$(e).attr("placeholder",t),$(e).attr("disabled",!0),this._stripe=$.ajax({url:"https://js.stripe.com/v3/",cache:!0,dataType:"script"}).then(e=>window.Stripe(STRIPE_PK)),this._card=this._stripe.then(t=>{let o=t.elements({locale:n}).create("card",{style:{base:{fontFamily:"Open Sans, sans-serif",fontSize:"16px",lineHeight:"1.5"}}});return o.mount(s),o.on("ready",t=>{$(s).show(),$(e).hide(),o.focus()}),o.on("change",this.onCardChanged.bind(this)),o})}onCardChanged(e){this._status.validCardNum=e.complete,e.error?this._status.errorMessage=e.error.message:this._status.errorMessage=""}charge(e,t){this._status.inProgress=!0,this._status.errorMessage="",this._status.success=!1;let n=$.ajax({url:STRIPE_PHP_URL,type:"POST",data:{currency:t,amount:e,captcha:this._status.captcha}});Promise.all([this._stripe,this._card,n]).then(([e,t,n])=>{e.confirmCardPayment(n.client_secret,{payment_method:{card:t}}).then(function(e){e.error?this.onPaymentFailed(e.error):e.paymentIntent.status==="succeeded"&&this.onPaymentSucceeded()}.bind(this))})}onPaymentFailed(e){console.warn("Stripe payment failed with error",e),this._status.success=!1,this._status.errorMessage=e.message,this._status.inProgress=!1,grecaptcha&&(this._status.captcha="",grecaptcha.reset())}onPaymentSucceeded(){console.info("Stripe payment succeeded!"),this._status.success=!0,this._status.errorMessage="",this._status.inProgress=!1,grecaptcha&&(this._status.captcha="",grecaptcha.reset())}}class RecurringPayment{checkout(e,t,n){let s=STRIPE_PLANS[t];$.ajax({url:"https://js.stripe.com/v3/",cache:!0,dataType:"script"}).then(e=>window.Stripe(STRIPE_PK)).then(t=>{t.redirectToCheckout({items:[{plan:s,quantity:parseInt(e)}],successUrl:window.location.href.split("#")[0]+"thanks",cancelUrl:window.location.href,locale:n}).then(e=>{e.error&&console.log(e.error.message)})})}}